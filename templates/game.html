<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Game Details: {{ game.name }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <h1>{{ game.name }}</h1>

        <section>
            {% if game.screenshots %}
                <div class="main">
                    <div class="slider">
                        <div class="img-container">
                            {% for shot in game.screenshots %}
                                <img src="{{ shot.path_full if shot.path_thumbnail else shot }}">
                            {% endfor %}
                        </div>

                        <div class="controls">
                            <button onclick="prev()">&lt;</button>
                            <button onclick="next()">&gt;</button>
                        </div>
                    </div>

                    <!-- Genres -->
                    <div>
                        <h3>Genres</h4>
                        <div class="tags">
                            {% for genre in game.genres %}
                                <div>{{ genre }}</div>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- PC Requirements -->
                    {% if game.pc_requirements %}
                    <div>
                        <h3>PC Requirements</h3>
                        <div class="pc-req">
                            <div>
                                {{ game.pc_requirements.minimum | safe }}
                            </div>
                            <div>
                                {{ game.pc_requirements.recommended | safe }}
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Reviews -->
                    <div>
                        <h3>Reviews</h3>
                        <p>English Reviews: {{ game.review_summary.description }} &lpar;{{ game.review_summary.total_reviews }} Reviews&rpar;</p>
                        <div class="review-section">
                            {% for review in game.reviews %}
                                <div class="review">
                                    {% if review.voted_up %}
                                        <p class="positive">Recommended</p>
                                    {% else %}
                                        <p class="negative">Not Recommended</p>
                                    {% endif %}
                                    <div class="review-text">{{ review.review | safe }}</div>
                                    <div class="review-footer">
                                        <div>Likes {{ review.votes_up }}</div>
                                        <div class="read-more" id="more-btn-{{ review.id }}" onclick="toggleRead({{ review.id }})">Read More</div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            {% endif %}
            <div class="side">
                {% if game.header_image %}
                    <img src="{{ game.header_image }}" alt="{{ game.name }} header image.">
                {% endif %}
                <div class="ratings">
                    <div class="scores">
                        {% if game.metacritic %}
                            <div>
                                <div class="rate">{{ game.metacritic.score }}</div>
                                <div>Metacritic</div>
                            </div>
                        {% endif %}
                        <div>
                            <div class="rate">{{ game.review_summary.positive_percentage }}&percnt;</div>
                            <div>Positive Reviews</div>
                        </div>
                        <div>
                            <div class="rate"">{{ game.tier | capitalize }}</div>
                            <div>ProtonDB</div>
                        </div>
                    </div>
                </div>
                <p>{{ game.short_description }}</p>

                <!-- Metadata -->
                <table>
                    <tbody>
                        <tr>
                            <td>Developer</td>
                            <td>{{ game.developers }}</td>
                        </tr>
                        <tr>
                            <td>Release Date</td>
                            <td>{{ game.release_date.date if game.release_date }}</td>
                        </tr>
                        <tr>
                            <td>Platform</td>
                            <td>
                                {% for platform, supported in game.platforms.items() %}
                                    {% if supported %}
                                        <span>{{ platform | capitalize }}</span>
                                    {% endif %}
                                {% endfor %}
                            </td>
                        </tr>
                        {% if game.website %}
                            <tr>
                                <td>Website</td>
                                <td>
                                    <a href="{{ game.website }}" target="_blank">Support</a>
                                </td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Background -->
        <!--{% if game.background_raw %}
            <div class="section">
                <h2>Background</h2>
                <img src="{{ game.background_raw }}">
            </div>
        {% endif %}-->

    </div>
    <script>
        const images = document.querySelectorAll(".slider img");
        images[0].classList.add("active");

        let current = 0;

        function show(index) {
            images[current].classList.remove("active");
            current = (index + images.length) % images.length;
            images[current].classList.add("active");
        }

        function next() {
            show(current + 1);
        }

        function prev() {
            show(current - 1);
        }

        const reviews = document.querySelectorAll(".review-text");
        const readMoreBtns = document.querySelectorAll(".read-more");
        const reviewTexts = [];
        const longReviewsIds = [];

        for (let i = 0; i < reviews.length; i++) {
          reviewTexts.push(reviews[i].textContent);
            if (reviews[i].textContent.length > 400) {
                reviews[i].textContent = reviews[i].textContent.slice(0, 400) + "...";
                readMoreBtns[i].style.display = "block";
            }
        }

        function toggleRead(id) {
            reviews[id].textContent = reviewTexts[id];
            readMoreBtns[id].style.display = "none";
        }
    </script>
</body>
</html>
